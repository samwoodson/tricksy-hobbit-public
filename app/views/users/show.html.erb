<div class="content-wrapper">
  <div class="container">
    <section class="content-header">
      <h1>Dashboard</h1>
    </section>


<!-- start process area -->
    <section class="content">
      <div class="callout callout-danger">
        <h4>Welcome <%= current_user.first_name %></h4>
        <p>Start a New Public or Private Trivia Game, or join a game</p>
      </div>
      <div class ="row">
        <div class="col-md-6 col-sm-3 text-right">
          <p> <%= form_for Game.new do |f| %>             
              <%= f.submit "New Public Game" ,:class => 'btn btn btn-success'%>
              <%= f.check_box :keep_private, checked_value: true %><span>Private Game</span>
            <% end %>
            
                <a class="btn btn btn-success" href="#">
                <i class="fa fa-play"></i>  New Public Game</a>

                <a class="btn btn btn-primary" href="#">
                <i class="fa fa-play"></i>  New Private Game</a>
                </p>
            </div>
          
          
            <div class="col-md-6 col-sm-3">
              <form id = "game-form" method="get" action="/games/">
                <div class="input-group">
                  <input type="text" name="game_number" class="form-control" placeholder="Enter room ID">
                    <span class="input-group-btn">
                      <button class="btn btn-default" type="submit">Join Game</button>
                    </span>
                  </div><!-- /input-group -->
                </form>
              </div><!-- /.col-md-6 -->
            </div>
          </section>
          <!-- /.box --> 
        <section >
           <div class="col-md-6">
                <!-- USERS LIST -->
                <div class="box box-danger">
                  <div class="box-header with-border">
                    <h3 class="box-title">Public Games</h3>

          
                  </div>
                  <!-- /.box-header -->
                  <div class="box-body no-padding">
                    <ul class="users-list clearfix">
                  

                     
           
           
              <% @games.each do |game| %>
               <li> <a id="game-<%=game.id%>" href="/games/<%=game.id%>">
                <%= image_tag game.owner.image, class: "img-circle" %></a>
                <span class="users-list-name"><%= game.owner.first_name %></span>
                <% end %>
                </li>
                                 
             
                    </ul>
                    <!-- /.users-list -->
                  </div>
                  <!-- /.box-body -->
                 
                  <!-- /.box-footer -->
                </div>
                <!--/.box -->
              </div>
              <!-- /.col -->
            
            <!-- /.row -->
            <div class="col-md-6">
            <div class="box box-default">
              <div class="box-header with-border">
                <h3 class="box-title">Game History</h3>
                 
         
              </div>

              <!-- /.box-header -->
              <div class="box-body">
                <div class="row">
                  <div class="col-md-6">
                    <div class="chart-responsive">
                    <%= render @user.games.where(status: :finished) %>
                      <canvas id="pieChart" height="150"></canvas>
                    </div>
                    <!-- ./chart-responsive -->
                  </div>
                  <!-- /.col -->
                
                  <!-- /.col -->
                </div>
                <!-- /.row -->
              </div>
              <!-- /.box-body -->           
              </div>
             </div>
          </div>
        </section>
      </div>
    </div>


<script>
App.cable.subscriptions.create({channel: "OverviewChannel"}, {
  received: (data) => {
    console.log(data);
    let gameList = $('#game-list');
    if (data.open_game && data.open_game.game.keep_private === 0){
      let owner = data.open_game.owner;
      let game = data.open_game.game;
      gameList.append($('<a>').text(owner.name + "'s Game").attr({id: `game-${game.id}`, href: `http://localhost:3000/games/${game.id}`}));
    } else if (data.close_game && (data.close_game.game.status === 'active' || data.close_game.game.status === 'finished')) {
      let game = data.close_game.game;
      gameList.find(`#game-${game.id}`).remove();
    }
  }
})


</script>
