Welcome to game <%= @game.id %>
<div class="container">
  <h1>
    Welcome to <%=@game.owner.first_name %>'s game!
  </h1>
</div>

<% if @game.owner.id == @user.id %>
  <div>
    <%= form_tag(game_play_game_path(@game), method: "get") do %>
                    <%= submit_tag "Start the game!" %>
                    <% end %>
  </div>
<% end %>

<div>
  Currently Waiting Players:
    <ul id="player-list"></ul>
    <% if @game.users.include?(@user) && @game.owner != @user %>
      <%= form_tag(game_path(@game), method: "patch") do %>
              <%= submit_tag "Leave this game!" %>
      <% end %>
    <% end %>
</div>

<% unless @game.owner == @user || @game.users.include?(@user) %>
  <%= form_tag(edit_game_path(@game), method: "get") do %>
                    <%= submit_tag "Join this game!" %>
                    <% end %>
<% end %>

<script>
App.cable.subscriptions.create({channel: "RoomChannel", game_id: <%= @game.id %>}, {
  received: (data) => {
    let playerList = $('#player-list');
    if (data.added_user) {
      let user = data.added_user;
      playerList.append($('<li>').text(user.name).attr("id", `user-${user.id}`));
    }
    else if (data.removed_user) {
      let user = data.removed_user;
      playerList.find(`#user-${user.id}`).remove();
    }
  }
})
</script>
