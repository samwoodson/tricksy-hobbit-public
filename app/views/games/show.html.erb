<div class="container">
  <h3>Game ID: <%= @game.id %></h3>
  <h1>
    Welcome to <%=@game.owner.first_name %>'s game!
  </h1>

  <section id="controls" class="col-md-6 col-md-offset-0">
    <% if @game.owner == current_user %>
      <%= button_to "Start the game!", game_play_game_path(@game), method: :get %>
    <% else %>
      <% if @player %>
        <%= button_to "Leave this game!", game_player_path(@game, @player), method: :delete %>
      <% else %>
        <%= button_to "Join this game!", game_players_path(@game) %>
      <% end %>
    <% end %>
  </section>
  <section id="wait-list">
    <h2>Currently Waiting Players:</h2>
    <ul id="player-list">
      <% @game.players.each do |player| %>
        <li id="user-<%= player.user.id %>"><%= player.user.name %></li>
      <% end %>
    </ul>
      <p id="demo" style="height: 150px;"></p>
  </section>

<script>
var redirected = false;
App.cable.subscriptions.create({channel: "RoomChannel", game_id: <%= @game.id %>}, {
  received: (data) => {
    let playerList = $('#player-list');
    if (data.added_user) {
      let user = data.added_user;
      playerList.append($('<li>').text(user.name).attr("id", `user-${user.id}`));
    }
    else if (data.removed_user) {
      let user = data.removed_user;
      playerList.find(`#user-${user.id}`).remove();
    }
    else if (data.game_start){
      let game = data.game_start.game
      if (redirected === false){
        window.location.replace("http://localhost:3000/games/"+game.id+"/play_game")
       redirected = true;
     }

    }
  }
})

$(function(){
  
    $('.boom').hide();
  
    $('#demo').pietimer({
      seconds: 10,
      color: 'rgba(215, 44, 90, 0.9)',
      height: 100,
      width: 100,
          is_reversed: true
    },
    function(){
     // $('.boom').show('slow');
    });
    
   // $('a#start').click(function(){
    //  $('.boom').hide();
      $('#demo').pietimer('start');
     // return false;
   // });
   // $('a#pause').click(function(){
   //   $('#demo').pietimer('pause');
    //  return false;
   // });
    
  });


</script>
