<div class="container">
  Game ID: <%= @game.id %>
  <h1>
    Welcome to <%=@game.owner.first_name %>'s game!
  </h1>
  <% if @game.owner.id == @user.id %>
  <div class="col-md-6 col-md-offset-0">
    <%= form_tag(game_play_game_path(@game), method: "get") do %>
    <%= submit_tag "Start the game!" %>
    <% end %>
  </div>
  <% end %>
</div><br>

<div>
  Currently Waiting Players:
  <ul id="player-list">
    <% @game.players.each do |player| %>
      <li id="user-<%= player.user.id %>"><%= player.user.name %></li>
    <% end %>
  </ul>
    <% if @game.users.include?(@user) && @game.owner != @user %>
      <%= form_tag(game_path(@game), method: "patch") do %>
      <%= submit_tag "Leave this game!" %>
      <% end %>
      <% end %>
    </div>

    <% unless @game.owner == @user || @game.users.include?(@user) %>
      <%= form_tag(edit_game_path(@game), method: "get") do %>
                        <%= submit_tag "Join this game!" %>
                        <% end %>
    <% end %>
  </div>
</div>

<script>
App.cable.subscriptions.create({channel: "RoomChannel", game_id: <%= @game.id %>}, {
  received: (data) => {
    let playerList = $('#player-list');
    if (data.added_user) {
      let user = data.added_user;
      playerList.append($('<li>').text(user.name).attr("id", `user-${user.id}`));
    }
    else if (data.removed_user) {
      let user = data.removed_user;
      playerList.find(`#user-${user.id}`).remove();
    }
  }
})
</script>
